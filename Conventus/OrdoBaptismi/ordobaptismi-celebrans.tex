% LuaLaTeX

\documentclass[a4paper, twoside, 12pt]{article}
\usepackage[latin]{babel}
%\usepackage[landscape, left=3cm, right=1.5cm, top=2cm, bottom=1cm]{geometry} % okraje stranky
\usepackage[portrait, a4paper, mag=1300, truedimen, left=0.8cm, right=0.8cm, top=0.8cm, bottom=0.8cm]{geometry} % okraje stranky

\usepackage{fontspec}
\setmainfont[FeatureFile={junicode.fea}, Ligatures={Common, TeX}, RawFeature=+fixi]{Junicode}
%\setmainfont{Junicode}

% shortcut for Junicode without ligatures (for the Czech texts)
\newfontfamily\nlfont[FeatureFile={junicode.fea}, Ligatures={Common, TeX}, RawFeature=+fixi]{Junicode}

\usepackage{multicol}
\usepackage{color}
\usepackage{lettrine}
\usepackage{fancyhdr}

% usual packages loading:
\usepackage{luatextra}
\usepackage{graphicx} % support the \includegraphics command and options
\usepackage{gregoriotex} % for gregorio score inclusion
\usepackage{gregoriosyms}
\usepackage{wrapfig} % figures wrapped by the text
\usepackage{parcolumns}
\usepackage[contents={},opacity=1,scale=1,color=black]{background}
\usepackage{tikzpagenodes}
\usepackage[savepos]{zref}
\usepackage{calc}
\usepackage{longtable}
\newif\ifparvulus
\parvulustrue

\setlength{\headheight}{12pt}

\input{conventuscommune.tex} % Often used macros
\input{translationes_cs.tex} % Czech translations of the proper texts

\setlength{\columnsep}{15pt} % prostor mezi sloupci

\makeatletter
\newcounter{litscore}
\newcounter{littabstop}[litscore]
\newcommand{\grealign}{%
	\@bsphack%
	\ifgre@boxing\else%
		\kern\gre@dimen@begindifference%
		\stepcounter{littabstop}%
		\expandafter\zsavepos{stop-\thelitscore-\thelittabstop}%
		\kern-\gre@dimen@begindifference%
	\fi%
	\@esphack%
}

\newcommand{\litsetstops}{%
  \gdef\nstabbing@stops{%
    \hspace*{-\oddsidemargin}\hspace{-1in}%
    \hspace*{\zposx{stop-\thelitscore-1} sp}\=%
  }%
  \count@=\@ne
  \loop\ifnum\count@<\value{littabstop}%
    \begingroup\edef\x{\endgroup
      \noexpand\g@addto@macro\noexpand\nstabbing@stops{%
        \noexpand\hspace{-\noexpand\zposx{stop-\thelitscore-\the\count@} sp}%
        \noexpand\hspace{\noexpand\zposx{stop-\thelitscore-\the\numexpr\count@+1} sp}\noexpand\=%
      }%
    }\x
    \advance\count@\@ne
  \repeat
  \nstabbing@stops\kill
}
\makeatother

\newenvironment{nstabbing}
  {\setlength{\topsep}{0pt}%
   \setlength{\partopsep}{0pt}%
   \tabbing%
   \litsetstops}
  {\endtabbing\stepcounter{litscore}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

% Here we set the space around the initial.
% Please report to http://home.gna.org/gregorio/gregoriotex/details for more details and options
\grechangedim{afterinitialshift}{2.2mm}{scalable}
\grechangedim{beforeinitialshift}{2.2mm}{scalable}
\grechangedim{interwordspacetext}{0.20 cm plus 0.15 cm minus 0.05 cm}{scalable}%
\grechangedim{annotationraise}{-0.2cm}{scalable}

% Here we set the initial font. Change 38 if you want a bigger initial.
% Emit the initials in red.
\grechangestyle{initial}{\color{red}\fontsize{38}{38}\selectfont}

\renewcommand{\headrulewidth}{0pt} % no horiz. rule at the header
\pagestyle{empty}

\grechangedim{spaceabovelines}{0.2cm}{scalable}%

\begin{center}
{\LARGE ORDO BAPTISMI PARVULORUM}
\end{center}

%\pars{Antiphona ad introitum} \scriptura{Cf. Gal. 6, 14; Ps. 66, 2.3.4; \textbf{E188}}
%
%\vspace{-0.6cm}
%
%\antiphona{IV}{temporalia/introitus-NosAutemp.gtex}
%
%\trIntroitus

\vfill

\setlength{\parindent}{0pt}
\renewcommand{\pars}[1]{{\bfseries\large\textsc{#1}}}
\renewcommand{\rubricatum}[1]{\textnormal{\color{red}\textit{#1}}}

\gresetnabcfont{grelaon}{8}

\pars{Antiphona ad introitum} \scriptura{Cf. Is. 55, 1; Ps. 77, 1; \textbf{L75}}

\vspace{-0.6cm}

\antiphona{II}{temporalia/introitus-Sitientes.gtex}

\vfill

\pars{Ritus recipiendi parvulum}

\ifparvulus
{\bfseries \input{temporalia/ritusrecipiendi-parvulus.tex} }
\else
{\bfseries \input{temporalia/ritusrecipiendi-parvula.tex} }
\fi

\vfill
\pagebreak

\pars{Sacra verbi Dei celebratio}

\gresetnabcfont{gregall}{8}

\pars{Alleluia} \scriptura{Ps. 67, 18.19; \textbf{C116}}

\vspace{-0.6cm}

\antiphona{VIII}{temporalia/alleluia-DominusInSina.gtex}

\gresetnabcfont{grelaon}{8}

\ifparvulus
{\bfseries \input{temporalia/evangelium-initium-parvulus.tex}}
\else
{\bfseries \input{temporalia/evangelium-initium-parvula.tex}}
\fi

\noindent\pars{Léctio sancti Evángelii secúndum Ioánnem.} \scriptura{Io. 19, 38-42}

\ifparvulus
{\bfseries \input{temporalia/evangelium-parvulus.tex}
\else
{\bfseries \input{temporalia/evangelium-parvula.tex}
\fi

\vfill

\noindent\pars{Oratio fidelium}

\ifparvulus
\input{temporalia/oratiofidelium-parvulus.tex}}
\else
\input{temporalia/oratiofidelium-parvula.tex}}
\fi

\sineinitiali{temporalia/terogamus.gtex}

\ifparvulus
{\bfseries \input{temporalia/oratiofidelium-2-parvulus.tex}}
\else
{\bfseries \input{temporalia/oratiofidelium-2-parvula.tex}}
\fi

\vspace{0.5cm}

\sineinitiali{temporalia/litaniae.gtex}

\begin{nstabbing}
\>Sancte Ioánnes \>\>\>Ba-\textbf{ptí}-\>\>\>sta, \>\>o-\>\textit{ra} \>\textit{pro} \textbf{no}bis.\\
\>Sancte \>\>\>\>\textbf{Io}-\>seph, \>\>\>o-\>\textit{ra} \>\textit{pro} \textbf{no}bis.\\
\>Sancti Petre et \>\>\>\>\textbf{Pau}-\>\>le, \>orá-\>\>\textit{te} \>\textit{pro} \textbf{no}bis.\\
\textellipsis
\end{nstabbing}

\pars{Oratio exorcismi et uncio præbaptismalis}

\ifparvulus
{\bfseries \input{temporalia/exorcismus-parvulus.tex}
\else
{\bfseries \input{temporalia/exorcismus-parvula.tex}
\fi

\vspace{0.7cm}

\pars{Celebratio baptismi}

\ifparvulus
\input{temporalia/celebratio-baptismi-parvulus.tex}
\else
\input{temporalia/celebratio-baptismi-parvula.tex}
\fi

\vfill

\pars{Ritus explanativi}

\ifparvulus
\input{temporalia/ritus-explanativi-parvulus.tex}}
\else
\input{temporalia/ritus-explanativi-parvula.tex}}
\fi

\pars{Conclusio ritus}

\scriptura{Gal. 3, 27; \textbf{L112}}

\vspace{-0.6cm}

\antiphona{II}{temporalia/communio-OmnesQui.gtex}

\ifparvulus
{\bfseries \input{temporalia/conclusio-ritus-parvulus.tex}}
\else
{\bfseries \input{temporalia/conclusio-ritus-parvula.tex}}
\fi

\vfill

\antiphona{VI}{temporalia/alleluia.gtex}

\scriptura{Ps. 117, 1-6}

\initiumpsalmi{temporalia/communio-versus-Confitemini-initium.gtex}

\input{communio-versus-Confitemini.tex}

\vfill

\end{document}
